<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="hif_setmodels" category="pipeline">
<shortdescription>Set calibrator source models</shortdescription>
<description>
Set calibrator source models
</description>
<input>
    <param type="string" name="vis" subparam="true">
	<description>List of input MeasurementSets</description>
	<value></value>
    </param>

    <param type="variant" name="reference" subparam="true">
	<description>Reference calibrator field name(s)</description>
	<value type="string"></value>
    </param>

    <param type="string" name="refintent" subparam="true">
	<description>Observing intent of reference fields</description>
	<value>AMPLITUDE</value>
    </param>

    <param type="variant" name="transfer" subparam="true">
	<description>Transfer calibrator field name(s)</description>
	<value type="string"></value>
    </param>

    <param type="string" name="transintent" subparam="true">
	<description>Observing intent of transfer fields</description>
	<value>BANDPASS</value>
    </param>

    <param type="string" name="reffile">
        <description>Path to file with fluxes for non-solar system calibrators</description>
        <value></value>
    </param>

    <param type="bool" name="normfluxes">
        <description>Normalize lookup fluxes</description>
        <value>True</value>
    </param>

    <param type="bool" name="scalebychan">
        <description>Scale the flux density on a per channel basis or else on a per spw basis</description>
        <value>True</value>
    </param>

    <param type="string" name="pipelinemode">
         <description>The pipeline operating mode</description>
	<value>automatic</value>
	<allowed kind="enum">
	    <value>automatic</value>
	    <value>interactive</value>
	    <value>getinputs</value>
	</allowed>
    </param>

    <param type="bool" name="dryrun" subparam="true">
	<description>Run the task (False) or display commands (True)</description>
	<value>False</value>
    </param>

    <param type="bool" name="acceptresults" subparam="true">
	<description>Automatically accept results into context</description>
	<value>True</value>
    </param>

    <constraints>
        <when param="pipelinemode">
	   <equals type="string" value="automatic" />
	   <equals type="string" value="interactive">
		<default param="vis"><value type="stringArray"></value></default>
		<default param="reference"><value type="string"></value></default>
		<default param="refintent"><value type="string">AMPLITUDE</value></default>
		<default param="transfer"><value type="string"></value></default>
		<default param="transintent"><value type="string">BANDPASS,PHASE,CHECK</value></default>
		<default param="dryrun"><value type="bool">False</value></default>
		<default param="acceptresults"><value type="bool">True</value></default>
	   </equals>
	   <equals type="string" value="getinputs">
		<default param="vis"><value type="stringArray"></value></default>
		<default param="reference"><value type="string"></value></default>
		<default param="refintent"><value type="string">AMPLITUDE</value></default>
		<default param="transfer"><value type="string">BANDPASS,PHASE,CHECK</value></default>
		<default param="transintent"><value type="string"></value></default>
	   </equals>
	</when>
    </constraints>

</input>

<output>
    <param type="any" name="results">
        <description>The output results object</description>
        <any type="variant"/>
        <value></value>
    </param>
</output>
<returns type="void"/>


<example>

Derive flux densities for point source transfer calibrators using flux models
for reference calibrators.

---- pipeline parameter arguments which can be set in any pipeline mode
pipelinemode -- The pipeline operating mode. In 'automatic' mode the pipeline
    determines the values of all context defined pipeline inputs automatically.
    In interactive mode the user can set the pipeline context defined
    parameters manually.  In 'getinputs' mode the users can check the settings
    of all pipeline parameters without running the task.
    default: 'automatic'.

reffile -- The reference file containing a lookup table of point source models
    This file currently defaults to 'flux.csv' in the working directory. This
    file must conform to the standard pipeline 'flux.csv' format
    default: ''
    example: 'myfluxes.csv'

normfluxes --  Normalize the transfer field lookup fluxes to 1.0. The reference
    field fluxes are never normalized.
    default: True
    example: False

scalebychan -- Scale the flux density on a per channel basis or else on a per spw basis
    default: True
    example: False


---- pipeline context defined parameter arguments which can be set only in
'interactive mode'

vis -- The list of input MeasurementSets. Defaults to the list of
    MeasurementSets specified in the pipeline context
    default: ''
    example: ['M32A.ms', 'M32B.ms']

reference -- A string containing a comma delimited list of  field names
    defining the reference calibrators. Defaults to field names with
    intent 'AMPLITUDE'.
    default: ''
    example: 'M82,3C273'

refintent -- A string containing a comma delimited list of intents 
    used to select the reference calibrators. Defaults to 'AMPLITUDE'.
    default: 'AMPLITUDE'. '' Means no sources.
    example: 'BANDPASS'

transfer -- A string containing a comma delimited list of  field names
    defining the transfer calibrators. Defaults to field names with
    intent ''.
    default: 'BANDPASS,PHASE,CHECK'
    example: 'J1328+041,J1206+30'

transintent -- A string containing a comma delimited list of intents 
    defining the transfer calibrators. Defaults to 'BANDPASS,PHASE,CHECK'.
    '' stands for no transfer sources.
    default: 'BANDPASS,PHASE,CHECK'
    example: 'PHASE'

--- pipeline task execution modes
dryrun -- Run the commands (True) or generate the commands to be run but
   do not execute (False).
   default: False

acceptresults -- Add the results of the task to the pipeline context (True) or
   reject them (False).
   default: True

Output:

results -- If pipeline mode is 'getinputs' then None is returned. Otherwise
    the results object for the pipeline task is returned


Description

Set model fluxes values for calibrator reference and transfer sources using lookup
values. By default the reference sources are the flux calibrators and the transfer
sources are the bandpass, phase, and check source calibrators. Reference sources
which are also in the transfer source list are removed from the transfer source list.

Built-in lookup tables are used to compute models for solar system object calibrators.
Point source models for other calibrators are provided in the reference file.
Normalize fluxes are computed for transfer sources if the normfluxes parameter is
set to True.

The reference file default to a file called 'flux.csv' in the current working
directory. This file is normal created in the importdata step. The file is in 
'csv' format and contains the following comma delimited columns.

vis,fieldid,spwid,I,Q,U,V,pix,comment

Issues

Examples

1. Set model fluxes for the flux, bandpass, phase, and check sources.

   hif_setmodels()

</example>

</task>
</casaxml>
